<!-- panel lista de usuarios -->
<ng-container *ngIf="!isCreacion && !isEdicion">

  <!-- boton crear usuario -->
  <div class="text-right mb-1">
    <button type="button" class="btn btn-success btn-sm" (click)="showPanelCrearUsuario()">
      <label class="btn-size-admin"><i class="fa fa-user-plus"></i> Registrar Usuario</label>
    </button>
  </div>

  <!-- tabla - usuarios -->
  <p-table [value]="usuarios"
    [responsive]="true"
    [paginator]="true"
    [rows]="10"
    rowHover="true">

    <ng-template pTemplate="caption">
      <i class="fa fa-users"> <span class="font-admin"> Usuarios Registrados</span></i>
    </ng-template>

    <ng-template pTemplate="header">
      <tr class="text-center">
        <th>Nombre Completo</th>
        <th>Usuario de Ingreso</th>
        <th style="width: 4%">Estado</th>
        <th style="width: 4%">Módulos Asignados</th>
        <th style="width: 4%">Generar Clave</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-user>
      <tr [pSelectableRow]="user">
        <td>{{user.nombre}}</td>
        <td>{{user.usuarioIngreso}}</td>
        <td>
          <button (click)="cambiarEstadoUsuario(user)" *ngIf="user.estado === 1" type="button" class="btn btn-outline-success btn-sm btn-block">Activo</button>
          <button (click)="cambiarEstadoUsuario(user)" *ngIf="user.estado === 2" type="button" class="btn btn-outline-danger btn-sm btn-block">Inactivo</button>
        </td>
        <td class="text-center">
          <button type="button" (click)="showModalEdicionModulos(user)" class="btn btn-sm btn-round-table btn-round-teal">
            <i class="pi pi-external-link icon-round-table"></i>
          </button>
        </td>
        <td class="text-center">
          <button (click)="generarNuevaClave(user)" type="button" class="btn btn-sm btn-round-table btn-round-teal">
            <i class="pi pi-unlock icon-round-table-2"></i>
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</ng-container>

<!-- panel creacion de usuarios -->
<ng-container *ngIf="isCreacion || isEdicion">

  <!-- panel principal -->
  <p-panel styleClass="steps-pnl-main">
    <p-header>
      <i class="fa fa-list-alt font-size-14"><span class="font-admin"> Creación de Usuario</span></i>
    </p-header>

    <!-- pasos de creacion o edicion -->
    <p-steps [styleClass]="stepsModel.styleClass" [model]="stepsModel.steps" [(activeIndex)]="stepsModel.activeIndex"></p-steps>
    <div class="mh-pnl-create">

      <!-- Paso 1 Datos Usuario-->
      <ng-container *ngIf="stepsModel.activeIndex === stepsModel.STEP_UNO">
        <form name="formUser" #formUser="ngForm"
        (ngSubmit)="limpiarMensajes() && formUser.form.valid && siguienteDatosUser()"
        (keydown.enter)="$event.preventDefault()" novalidate>

          <p-panel styleClass="mr-4 ml-4 mb-2 steps-pnl">
            <p-header>
              <i class="fa fa-info-circle font-size-18"></i>
              <span> Datos del usuario, todos los valores son obligatorios</span>
            </p-header>

            <table class="table steps-tbl mb-0">
              <tbody>
                <!-- nombre -->
                <tr>
                  <td style="width: 17%">
                    <label for="username" class="steps-st mb-0">Nombre Completo:</label>
                  </td>
                  <td>
                    <input type="text"
                      id="username"
                      name="username"
                      [(ngModel)]="usuarioCU.nombre"
                      #username="ngModel"
                      maxlength="100"
                      adminRequired
                      adminAutofocus
                      autocomplete="off"
                      class="ad-input ad-input-style w-100"
                      [ngClass]="{'ad-input-required' : (formUser.submitted && !username.valid)}"/>
                    <div class="focus-border"></div>
                  </td>
                </tr>

                <!-- usuario - ingreso -->
                <tr>
                  <td style="width: 17%">
                    <label for="useringreso" class="steps-st mb-0">Usuario Ingreso:</label>
                  </td>
                  <td>
                    <input type="text"
                      id="useringreso"
                      name="useringreso"
                      [(ngModel)]="usuarioCU.usuarioIngreso"
                      #useringreso="ngModel"
                      maxlength="50"
                      adminRequired
                      autocomplete="off"
                      class="ad-input ad-input-style w-100"
                      [ngClass]="{'ad-input-required' : (formUser.submitted && !useringreso.valid)}"/>
                    <div class="focus-border"></div>
                  </td>
                </tr>
              </tbody>
            </table>
          </p-panel>

          <!-- botones salir - next-->
          <div class="text-center mb-1">
            <button type="button" (click)="closePanelCU()" class="btn btn-sm btn-secondary mr-1 w-100-px">
              <label class="btn-size-admin"><i class="fa fa-times"></i> Salir</label>
            </button>
            <button type="button" (click)="formUser.onSubmit()" class="btn btn-sm btn-primary w-100-px">
              <label class="btn-size-admin">Siguiente <i class="fa fa-hand-o-right"></i></label>
            </button>
          </div>
        </form>
      </ng-container>
    </div>
  </p-panel>
</ng-container>

<!-- modal de edicion de modulos -->
<p-dialog header="Edición de Módulos" [(visible)]="isModalEdicionModulos" *ngIf="usuarioEdicionModulos" modal="true">

  <div class="text-center mb-3">
    <p class="font-weight-bold font-new-roman font-size-16">{{usuarioEdicionModulos.nombre}}</p>
  </div>

  <div>
    <p class="text-assign-modulos"><i class="fa fa-info-circle color-info font-size-16"></i> Módulos Asignados</p>
    <ng-container *ngTemplateOutlet="tblModulos"></ng-container>
  </div>

  <div class="text-center">
    <button type="button" class="btn btn-success btn-sm btn-regresar" (click)="editarModulos()">
      <label class="btn-size-admin"><i class="fa fa-pencil"></i> Editar</label>
    </button>
    <button type="button" class="btn btn-secondary btn-sm btn-crear-user" (click)="closeModalEdicionModulos()">
      <label class="btn-size-admin"><i class="fa fa-times"></i> Salir</label>
    </button>
  </div>
</p-dialog>

<!-- template asignacion - edicion modulos -->
<ng-template #tblModulos>
  <table class="table table-modulos table-hover mb-0">
    <tbody>
      <tr>
        <td>
          <admin-inputswitch
            [isChecked]="selectedModulos.correspondencia"
            label="Correspondencia"
            (switchChange)="selectedModulos.correspondencia=$event">
          </admin-inputswitch>
        </td>
        <td>
          <p class="sub-title-page">Módulo que permite administrar los consecutivos de correspondencia tales como solicitar, modificar, anular</p>
        </td>
      </tr>
      <tr>
        <td>
          <admin-inputswitch
            [isChecked]="selectedModulos.archivoGestion"
            label="Archivo de Gestión"
            (switchChange)="selectedModulos.archivoGestion=$event">
          </admin-inputswitch>
        </td>
        <td>
          <p class="sub-title-page">Módulo que permite archivar los consecutivos de correspondencia solicitados en series documentales</p>
        </td>
      </tr>
      <tr>
        <td>
          <admin-inputswitch
            [isChecked]="selectedModulos.reportes"
            label="Reportes"
            (switchChange)="selectedModulos.reportes=$event">
          </admin-inputswitch>
        </td>
        <td>
          <p class="sub-title-page">Módulo que permite generar reportes de los consecutivos de correspondencia solicitados en diferentes formatos</p>
        </td>
      </tr>
      <tr>
        <td>
          <admin-inputswitch
            [isChecked]="selectedModulos.configuraciones"
            label="Configuraciones"
            (switchChange)="selectedModulos.configuraciones=$event">
          </admin-inputswitch>
        </td>
        <td>
          <p class="sub-title-page">Módulo administrativo del sistema, solo para usuarios con ROL de administrador</p>
        </td>
      </tr>
    </tbody>
  </table>
</ng-template>
